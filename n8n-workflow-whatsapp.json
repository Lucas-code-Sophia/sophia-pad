{
  "name": "Sophia-Pad ‚Äì WhatsApp R√©servations",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "c1000001-0001-0001-0001-000000000001",
      "name": "‚è∞ Confirmation J-1 (10h)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 0]
    },
    {
      "parameters": {
        "jsCode": "// Calcule la date de demain au format YYYY-MM-DD\nconst tomorrow = new Date();\ntomorrow.setDate(tomorrow.getDate() + 1);\nconst dateStr = tomorrow.toISOString().split('T')[0];\nreturn [{ json: { target_date: dateStr, flow: 'confirmation' } }];"
      },
      "id": "c1000001-0001-0001-0001-000000000002",
      "name": "üìÖ Calcul date demain",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 0]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?whatsapp_confirmation_requested=eq.true&whatsapp_confirmation_sent=eq.false&reservation_date=eq.{{ $json.target_date }}&status=eq.confirmed&select=id,customer_name,customer_phone,reservation_date,reservation_time,party_size,tables(table_number)",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            }
          ]
        },
        "options": {}
      },
      "id": "c1000001-0001-0001-0001-000000000003",
      "name": "üîç R√©sas demain √† confirmer",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [660, 0]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-confirm-has-data",
              "leftValue": "={{ $json.customer_phone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c1000001-0001-0001-0001-000000000004",
      "name": "‚úÖ A un t√©l√©phone ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 0]
    },
    {
      "parameters": {
        "jsCode": "// Formater le num√©ro de t√©l√©phone pour WhatsApp\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n  let phone = (data.customer_phone || '').replace(/[\\s\\-\\.\\(\\)]/g, '');\n  \n  // Convertir format fran√ßais 06... en +336...\n  if (phone.startsWith('0')) {\n    phone = '33' + phone.slice(1);\n  } else if (phone.startsWith('+')) {\n    phone = phone.slice(1);\n  }\n  \n  // Formater la date en fran√ßais\n  const dateObj = new Date(data.reservation_date + 'T00:00:00');\n  const jours = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];\n  const mois = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];\n  const dateStr = `${jours[dateObj.getDay()]} ${dateObj.getDate()} ${mois[dateObj.getMonth()]}`;\n  \n  // Formater l'heure\n  const timeStr = (data.reservation_time || '').slice(0, 5).replace(':', 'h');\n  \n  // Nom de la table\n  const tableName = data.tables?.table_number || 'N/A';\n  \n  results.push({\n    json: {\n      ...data,\n      whatsapp_phone: phone,\n      formatted_date: dateStr,\n      formatted_time: timeStr,\n      table_name: tableName\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "c1000001-0001-0001-0001-000000000005",
      "name": "üì± Formater t√©l√©phone (Confirm)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, -60]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v21.0/VOTRE_PHONE_NUMBER_ID/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_WHATSAPP_ACCESS_TOKEN"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.whatsapp_phone }}\",\n  \"type\": \"template\",\n  \"template\": {\n    \"name\": \"reservation_confirmation\",\n    \"language\": { \"code\": \"fr\" },\n    \"components\": [\n      {\n        \"type\": \"body\",\n        \"parameters\": [\n          { \"type\": \"text\", \"text\": \"{{ $json.customer_name }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.formatted_date }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.formatted_time }}\" },\n          { \"type\": \"text\", \"text\": \"{{ $json.party_size }}\" }\n        ]\n      }\n    ]\n  }\n}",
        "options": {}
      },
      "id": "c1000001-0001-0001-0001-000000000006",
      "name": "üí¨ Envoyer WhatsApp Confirmation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1320, -60]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?id=eq.{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"whatsapp_confirmation_sent\": true }",
        "options": {}
      },
      "id": "c1000001-0001-0001-0001-000000000007",
      "name": "‚úÖ Marquer confirmation envoy√©e",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1540, -60]
    },

    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 14,
              "triggerAtMinute": 0
            }
          ]
        }
      },
      "id": "c1000001-0002-0001-0001-000000000001",
      "name": "‚è∞ Avis J+1 (14h)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 340]
    },
    {
      "parameters": {
        "jsCode": "// Calcule la date d'hier au format YYYY-MM-DD\nconst yesterday = new Date();\nyesterday.setDate(yesterday.getDate() - 1);\nconst dateStr = yesterday.toISOString().split('T')[0];\nreturn [{ json: { target_date: dateStr, flow: 'review' } }];"
      },
      "id": "c1000001-0002-0001-0001-000000000002",
      "name": "üìÖ Calcul date hier",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 340]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?whatsapp_review_requested=eq.true&whatsapp_review_sent=eq.false&reservation_date=eq.{{ $json.target_date }}&status=eq.completed&select=id,customer_name,customer_phone,reservation_date",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            }
          ]
        },
        "options": {}
      },
      "id": "c1000001-0002-0001-0001-000000000003",
      "name": "üîç R√©sas termin√©es hier (avis)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [660, 340]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-review-has-data",
              "leftValue": "={{ $json.customer_phone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c1000001-0002-0001-0001-000000000004",
      "name": "‚úÖ A un t√©l√©phone ? (Avis)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [880, 340]
    },
    {
      "parameters": {
        "jsCode": "// Formater le num√©ro de t√©l√©phone pour WhatsApp\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n  let phone = (data.customer_phone || '').replace(/[\\s\\-\\.\\(\\)]/g, '');\n  \n  if (phone.startsWith('0')) {\n    phone = '33' + phone.slice(1);\n  } else if (phone.startsWith('+')) {\n    phone = phone.slice(1);\n  }\n  \n  results.push({\n    json: {\n      ...data,\n      whatsapp_phone: phone\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "c1000001-0002-0001-0001-000000000005",
      "name": "üì± Formater t√©l√©phone (Avis)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 280]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v21.0/VOTRE_PHONE_NUMBER_ID/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_WHATSAPP_ACCESS_TOKEN"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.whatsapp_phone }}\",\n  \"type\": \"template\",\n  \"template\": {\n    \"name\": \"review_request\",\n    \"language\": { \"code\": \"fr\" },\n    \"components\": [\n      {\n        \"type\": \"body\",\n        \"parameters\": [\n          { \"type\": \"text\", \"text\": \"{{ $json.customer_name }}\" }\n        ]\n      }\n    ]\n  }\n}",
        "options": {}
      },
      "id": "c1000001-0002-0001-0001-000000000006",
      "name": "üí¨ Envoyer WhatsApp Avis",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1320, 280]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?id=eq.{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{ \"whatsapp_review_sent\": true }",
        "options": {}
      },
      "id": "c1000001-0002-0001-0001-000000000007",
      "name": "‚úÖ Marquer avis envoy√©",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1540, 280]
    },

    {
      "parameters": {
        "httpMethod": "POST",
        "path": "whatsapp-webhook",
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000001",
      "name": "üîî Webhook WhatsApp (r√©ponses)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 680],
      "webhookId": "whatsapp-webhook-sophia"
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "whatsapp-webhook",
        "options": {
          "responseData": "={{ $json.hub?.challenge || 'ok' }}"
        }
      },
      "id": "c1000001-0003-0001-0001-000000000010",
      "name": "üîî Webhook Verify (GET)",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 900],
      "webhookId": "whatsapp-webhook-verify"
    },
    {
      "parameters": {
        "jsCode": "// Parser la r√©ponse WhatsApp entrante\nconst body = $input.first().json.body || $input.first().json;\n\n// WhatsApp Cloud API webhook structure\nconst entry = body.entry?.[0];\nconst changes = entry?.changes?.[0];\nconst value = changes?.value;\n\n// V√©rifier si c'est un message entrant (pas un status update)\nif (!value?.messages || value.messages.length === 0) {\n  return [{ json: { skip: true, reason: 'Pas un message entrant (status update)' } }];\n}\n\nconst message = value.messages[0];\nconst from = message.from; // num√©ro du client (ex: 33612345678)\nconst text = (message.text?.body || '').toLowerCase().trim();\nconst timestamp = message.timestamp;\n\n// D√©terminer l'intention du client\nlet intent = 'unknown';\nconst confirmWords = ['oui', 'yes', 'ok', 'confirme', 'confirm√©', 'je confirme', 'c\\'est bon', 'parfait', 'super', 'üëç', '‚úÖ'];\nconst cancelWords = ['non', 'no', 'annule', 'annuler', 'annul√©', 'je ne peux pas', 'impossible', 'cancel', '‚ùå'];\n\nfor (const w of confirmWords) {\n  if (text.includes(w)) { intent = 'confirmed'; break; }\n}\nif (intent === 'unknown') {\n  for (const w of cancelWords) {\n    if (text.includes(w)) { intent = 'cancelled'; break; }\n  }\n}\n\nreturn [{\n  json: {\n    skip: false,\n    from_phone: from,\n    message_text: text,\n    intent: intent,\n    timestamp: timestamp,\n    raw: body\n  }\n}];"
      },
      "id": "c1000001-0003-0001-0001-000000000002",
      "name": "üß† Parser la r√©ponse",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 680]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-not-skip",
              "leftValue": "={{ $json.skip }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "cond-has-intent",
              "leftValue": "={{ $json.intent }}",
              "rightValue": "unknown",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000003",
      "name": "üéØ Intention reconnue ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [660, 680]
    },
    {
      "parameters": {
        "jsCode": "// Chercher la r√©servation correspondant au num√©ro de t√©l√©phone\n// Le num√©ro WhatsApp est au format 33XXXXXXXXX\n// On doit retrouver la r√©sa la plus proche dans le futur\nconst data = $input.first().json;\nconst phone = data.from_phone;\n\n// Formater le num√©ro pour chercher dans la BDD\n// Le t√©l√©phone peut √™tre stock√© comme 06..., +33..., ou 33...\nlet searchPhones = [];\nif (phone.startsWith('33')) {\n  searchPhones.push('0' + phone.slice(2));      // 0612345678\n  searchPhones.push('+33' + phone.slice(2));     // +33612345678\n  searchPhones.push('33' + phone.slice(2));      // 33612345678\n  searchPhones.push('+' + phone);                // +33612345678\n}\nsearchPhones.push(phone);\n\nreturn [{\n  json: {\n    ...data,\n    search_phones: searchPhones,\n    // On va chercher avec le format le plus courant en France (06...)\n    search_phone_main: phone.startsWith('33') ? '0' + phone.slice(2) : phone\n  }\n}];"
      },
      "id": "c1000001-0003-0001-0001-000000000004",
      "name": "üì± Formater num√©ro recherche",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [880, 620]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?customer_phone=ilike.*{{ $json.search_phone_main.slice(-9) }}&status=eq.confirmed&reservation_date=gte.{{ new Date().toISOString().split('T')[0] }}&order=reservation_date.asc&limit=1&select=id,customer_name,customer_phone,reservation_date,reservation_time,party_size,status",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            }
          ]
        },
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000005",
      "name": "üîç Trouver la r√©servation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1100, 620]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-found-resa",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000006",
      "name": "üìã R√©sa trouv√©e ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1320, 620]
    },
    {
      "parameters": {
        "jsCode": "// Pr√©parer la mise √† jour selon l'intention\nconst resa = $('üîç Trouver la r√©servation').first().json;\nconst intent = $('üß† Parser la r√©ponse').first().json.intent;\nconst messageText = $('üß† Parser la r√©ponse').first().json.message_text;\n\nlet newStatus = resa.status;\nlet replyMessage = '';\n\nif (intent === 'confirmed') {\n  // La r√©sa reste confirm√©e, on note que le client a confirm√©\n  replyMessage = `Merci ${resa.customer_name} ! ‚úÖ\\n\\nVotre r√©servation est bien confirm√©e :\\nüìÖ ${resa.reservation_date}\\nüïê ${(resa.reservation_time || '').slice(0, 5)}\\nüë• ${resa.party_size} personne(s)\\n\\n√Ä bient√¥t ! üòä`;\n} else if (intent === 'cancelled') {\n  newStatus = 'cancelled';\n  replyMessage = `Merci ${resa.customer_name} pour votre retour.\\n\\n‚ùå Votre r√©servation du ${resa.reservation_date} √† ${(resa.reservation_time || '').slice(0, 5)} a bien √©t√© annul√©e.\\n\\nN'h√©sitez pas √† nous recontacter pour une prochaine r√©servation ! üòä`;\n}\n\n// Formater le num√©ro pour l'envoi\nlet phone = (resa.customer_phone || '').replace(/[\\s\\-\\.\\(\\)]/g, '');\nif (phone.startsWith('0')) {\n  phone = '33' + phone.slice(1);\n} else if (phone.startsWith('+')) {\n  phone = phone.slice(1);\n}\n\nreturn [{\n  json: {\n    reservation_id: resa.id,\n    new_status: newStatus,\n    intent: intent,\n    reply_message: replyMessage,\n    whatsapp_phone: phone,\n    customer_name: resa.customer_name\n  }\n}];"
      },
      "id": "c1000001-0003-0001-0001-000000000007",
      "name": "üßÆ Pr√©parer mise √† jour",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1540, 560]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://geqxvlieqwrssuipypju.supabase.co/rest/v1/reservations?id=eq.{{ $json.reservation_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "VOTRE_SUPABASE_ANON_KEY"
            },
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_SUPABASE_SERVICE_ROLE_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"status\": \"{{ $json.new_status }}\", \"confirmed\": {{ $json.intent === 'confirmed' ? 'true' : 'false' }} }",
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000008",
      "name": "üíæ Mettre √† jour r√©sa",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1760, 560]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v21.0/VOTRE_PHONE_NUMBER_ID/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer VOTRE_WHATSAPP_ACCESS_TOKEN"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.whatsapp_phone }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"{{ $json.reply_message }}\"\n  }\n}",
        "options": {}
      },
      "id": "c1000001-0003-0001-0001-000000000009",
      "name": "üí¨ R√©pondre au client",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1980, 560]
    }
  ],

  "connections": {
    "‚è∞ Confirmation J-1 (10h)": {
      "main": [
        [{ "node": "üìÖ Calcul date demain", "type": "main", "index": 0 }]
      ]
    },
    "üìÖ Calcul date demain": {
      "main": [
        [{ "node": "üîç R√©sas demain √† confirmer", "type": "main", "index": 0 }]
      ]
    },
    "üîç R√©sas demain √† confirmer": {
      "main": [
        [{ "node": "‚úÖ A un t√©l√©phone ?", "type": "main", "index": 0 }]
      ]
    },
    "‚úÖ A un t√©l√©phone ?": {
      "main": [
        [{ "node": "üì± Formater t√©l√©phone (Confirm)", "type": "main", "index": 0 }],
        []
      ]
    },
    "üì± Formater t√©l√©phone (Confirm)": {
      "main": [
        [{ "node": "üí¨ Envoyer WhatsApp Confirmation", "type": "main", "index": 0 }]
      ]
    },
    "üí¨ Envoyer WhatsApp Confirmation": {
      "main": [
        [{ "node": "‚úÖ Marquer confirmation envoy√©e", "type": "main", "index": 0 }]
      ]
    },

    "‚è∞ Avis J+1 (14h)": {
      "main": [
        [{ "node": "üìÖ Calcul date hier", "type": "main", "index": 0 }]
      ]
    },
    "üìÖ Calcul date hier": {
      "main": [
        [{ "node": "üîç R√©sas termin√©es hier (avis)", "type": "main", "index": 0 }]
      ]
    },
    "üîç R√©sas termin√©es hier (avis)": {
      "main": [
        [{ "node": "‚úÖ A un t√©l√©phone ? (Avis)", "type": "main", "index": 0 }]
      ]
    },
    "‚úÖ A un t√©l√©phone ? (Avis)": {
      "main": [
        [{ "node": "üì± Formater t√©l√©phone (Avis)", "type": "main", "index": 0 }],
        []
      ]
    },
    "üì± Formater t√©l√©phone (Avis)": {
      "main": [
        [{ "node": "üí¨ Envoyer WhatsApp Avis", "type": "main", "index": 0 }]
      ]
    },
    "üí¨ Envoyer WhatsApp Avis": {
      "main": [
        [{ "node": "‚úÖ Marquer avis envoy√©", "type": "main", "index": 0 }]
      ]
    },

    "üîî Webhook WhatsApp (r√©ponses)": {
      "main": [
        [{ "node": "üß† Parser la r√©ponse", "type": "main", "index": 0 }]
      ]
    },
    "üß† Parser la r√©ponse": {
      "main": [
        [{ "node": "üéØ Intention reconnue ?", "type": "main", "index": 0 }]
      ]
    },
    "üéØ Intention reconnue ?": {
      "main": [
        [{ "node": "üì± Formater num√©ro recherche", "type": "main", "index": 0 }],
        []
      ]
    },
    "üì± Formater num√©ro recherche": {
      "main": [
        [{ "node": "üîç Trouver la r√©servation", "type": "main", "index": 0 }]
      ]
    },
    "üîç Trouver la r√©servation": {
      "main": [
        [{ "node": "üìã R√©sa trouv√©e ?", "type": "main", "index": 0 }]
      ]
    },
    "üìã R√©sa trouv√©e ?": {
      "main": [
        [{ "node": "üßÆ Pr√©parer mise √† jour", "type": "main", "index": 0 }],
        []
      ]
    },
    "üßÆ Pr√©parer mise √† jour": {
      "main": [
        [
          { "node": "üíæ Mettre √† jour r√©sa", "type": "main", "index": 0 },
          { "node": "üí¨ R√©pondre au client", "type": "main", "index": 0 }
        ]
      ]
    }
  },

  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 3,
  "pinData": {}
}

